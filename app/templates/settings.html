{% extends "layout.html" %}

{% block main %}
  <div id="settings-form">
    <form action="" method="post" novalidate>
      {{ settings.hidden_tag() }}

      <p>
        {{ settings.color_mode() }} {{ settings.color_mode.label }}
      </p>
      <p>
        {{ settings.region.label }}<br>
        {{ settings.region() }}
      </p>
      <p>
        {{ settings.submit() }}
      </p>
    </form>
  </div>

  <script>
    async function setUserSettings(setting, optionValue) {
      let response = await fetch(`api/settings/set-settings?setting=${setting}&option=${optionValue}`, {
        headers: {
          'Request-Source': 'JS-AJAX'
        }
      });
    }

    colorPalette = document.getElementById('color-palette');
    colorPalette.addEventListener('change', () => {
      let colorPaletteValue = localStorage.getItem('dark-mode') === '2' ? '1' : '2';
      localStorage.setItem('dark-mode', colorPaletteValue);
      setUserSettings('1', colorPaletteValue);
    });
  </script>
{% endblock %}