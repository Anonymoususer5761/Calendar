{% extends 'layout.html' %}

{% block style %}
    <link rel="stylesheet" href="{{ url_for('static', filename='dates.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
{% endblock %}

{% block main %}
    <p id="selected-date" class="h1 text-primary" value="{{ date_id }}">
        <span class="change-date-arrow">
            <i id="go-back" class="bi bi-arrow-left-short text-secondary"></i>
        </span>
        {{ date }}
        <span class="change-date-arrow">
            <i id="go-forward" class="bi bi-arrow-right-short text-secondary"></i>
        </span>
    </p>

    {% if current_user.is_authenticated %}
        <div id="add-event-modal" class="modal fade" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content bg-quaternary">
                    <div class="modal-header bg-header text-light">
                        <p id="modal-title" class="h5 modal-title text-uppercase">
                            <span>
                                <i class="bi bi-calendar4-event"></i>
                            </span>
                            Add an Event
                        </p>
                        <a class="btn btn-sm btn-secondary btn-close bg-light" role="button" data-bs-dismiss="modal" aria-label="close"></a>
                    </div>
                    <div class="form d-flex align-items-between justify-content-center">
                        <form class="p-3" action="" method="post" style="width: 100%;">
                            {{ add_event_form.hidden_tag() }}
                            <div class="m-2">
                                {{ add_event_form.name.label(class="form-label h1 small fw-bold") }}
                                {{ add_event_form.name(class="form-control border-bottom", autocomplete="off", autofocus=autofocus) }}
                            </div>
                            <div class="m-2">
                                {{ add_event_form.description.label(class="form-label small fw-bold") }}
                                {{ add_event_form.description(class="form-control border-bottom", autocomplete="off") }}
                            </div>
                            <div class="m-2">
                                {{ add_event_form.start_time.label(class="form-label small fw-bold") }}
                                {{ add_event_form.start_time(class="form-control", value=add_event_form.start_time.default) }}
                            </div>
                            <div class="m-2">
                                {{ add_event_form.end_time.label(class="form-label small fw-bold") }}
                                {{ add_event_form.end_time(class="form-control",value=add_event_form.start_time.default) }}
                            </div>
                        <div class="m-2">
                                {{ add_event_form.event_color.label(class="form-label small fw-bold") }}
                                {{ add_event_form.event_color(id="colorInput", class="form-control form-control-color", type="color", value="#99c1f1", title="Color") }}
                            </div>
                            <div class="m-3">
                                {{ add_event_form.submit(class="btn btn-secondary btn-flex small") }}
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div id="alert-modal" class="modal fade" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <p id="modal-title" class="h5 modal-title">Login Required</p>
                        <a class="btn btn-sm btn-secondary btn-close" role="button" data-bs-dismiss="modal" aria-label="close"></a>
                    </div>
                    <a href="{{ url_for('login') }}" class="btn btn-sm btn-secondary" role="button">Sign In</a>
                </div>
            </div>
        </div>
    {% endif %}

    <div class="container-fluid my-5 ms-3 me-5">
        <div class="d-flex m-2">
            <a class="btn btn-sm btn-outline-secondary rounded mx-5 my-0" role="button" data-bs-toggle="modal" {% if current_user.is_authenticated %} data-bs-target="#add-event-modal" {% else %} data-bs-target="#alert-modal"{% endif %}>
                Add Event
            </a>
        </div>
        <div class="row justify-content-center">
            <div id="day-name" class="day-name text-center">{{ day_name }}</div>
        </div>
        <div id="relative-row" class="row">
            <svg class="col-2 col-sm-1 row m-0 p-0 hours-row-svg" height="2600" width="100%">
                <text class="hours-label" x="37.5%" y="22">23:00</text>
                <text id="yesterday" class="yesterday" x="37.5%" y="67">Yesterday</text>
                {% for i in range(24) %}
                    <text class="hours-label" x="37.5%" y="{{ i * 100 + 122 }}">{{ "{:02d}".format(i) }}:00</text>
                {% endfor %}
                <text class="hours-label" x="37.5%" y="2522">00:00</text>
            </svg>
            <div id="day-timeline" class="col-6 p-0 ms-0 mt-3 pe-5">
                <svg id="timeline-svgs" height="2500" width="100%">
                    <g class="rects">
                        {{ event_rects|safe }}
                    </g>
                    <g class="hours-line-svg">
                        {% for i in range(1, 25) %}
                            <line class="hours-line" x1="0" y1="{{ i * 100 }}" x2="100%" y2="{{ i * 100}}"></line>
                        {% endfor %}
                        <line class="now-line" x1="0" y1="50" x2="100%" y2="50"></line>
                    </g>
                </svg>
            </div>
        </div>
    </div>

    <!-- AI Usage Disclaimer: I used Gemini to style this div element and its children. -->
    <div id="event-details-popup" class="ms-2 mt-2 rounded bg-light position-absolute">
        <div class="card-header bg-event-color container py-2 px-3 rounded d-flex justify-content-between">
            <div class="d-flex align-items-center flex-start">
                <small class="text-uppercase fw-bold">Events</small>
            </div>
            <div><i class="edit-icon bi bi-pen"></i></div>
        </div>

        <div class="card-body">
            <h5 id="event-title" class="card-title fw-bold text-dark mb-2"></h5>
            
            <p id="description-card" class="card-text text-muted small border-bottom pb-2 mb-3"></p>

            <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex align-items-center px-0 py-1">
                    <i class="bi bi-clock-history text-secondary me-2"></i>
                    <span id="duration" class="card-link fw-semibold text-primary small"></span>
                </li>
                
                <li class="list-group-item d-flex align-items-start px-0 py-1">
                    <i class="bi bi-calendar-range text-secondary me-2 mt-1"></i>
                    <span id="timings" class="card-link text-wrap small"></span>
                </li>
            </ul>
        </div>
    </div>

{% endblock main %}

{% block script %}
    <script src="{{ url_for('static', filename='dates.js') }}"></script>
{% endblock %}